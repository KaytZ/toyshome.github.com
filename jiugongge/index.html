<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>诗词九宫格</title>
		<script src="js/mobilebone.js"></script>
		<script src="js/jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="css/mobilebone.css"/>
		<link rel="stylesheet" href="css/base.css" />
	</head>
	<body>
		<div id="pageHome" class="page out hide">
			<div class="loading-mask">
				<div class="loading-txt">诗词九宫格</div>
				<div class="loading"></div>
			</div>
			<div class="title tx-c">诗词九宫格</div>
			<a class="btn btn-begin" href="#choose-mission">开始</a>
			<a class="btn btn-begin">更多</a>
			<div class="tx-c">好七喵书院出品</div>
		</div>
		<!--
        	时间：2017-06-30
        	描述：选关卡
        -->
		<div id="choose-mission" class="page out">
			<div class="title1">选择关卡</div>
			<div class="mission-blocks"></div>
		</div>
		<!--
			时间：2017-06-30
        	描述：答题页
        -->
		<div id="mission" class="page out">
			<div class="tx-r">
				<button class="btn btn-help">求助</button>
				<button class="btn btn-question">?</button>
			</div>
			<div class="words">
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
				<div class="words-block"><span></span></div>
			</div>
			<div class="answer">
				<div class="answer-words"></div>
				<div class="answer-words"></div>
				<div class="answer-words"></div>
				<div class="answer-words"></div>
				<div class="answer-words"></div>
			</div>
		</div>
		
		<div class="tip hide"></div>
		
		<script>
			window.onload=function(){
				$(".loading-mask").hide();
			}
			var data;//模拟的json数据
			$.ajax({
				type:"get",
				url:"data.json",
				async:false,
				success:function(json){
					data=json;
				}
			});
			var missionCount=data.missionCount;//假设有50关
			var unlockedCount=data.unlockedCount;//假设解锁了3关
			var missionBlocks='';
			const GRID_COUNT=9;//9宫格9个格子
			
			var timer=null;
			window.tip=function(str){
				$(".tip").text(str).show();
				clearTimeout(timer)
				timer=setTimeout(function(){
					$(".tip").hide();
				},1000)
			}
			//生成关卡数
			for(var i=1;i<=missionCount;i++){
				if(i<=unlockedCount){
					missionBlocks+='<div class="mission active" onclick="chooseMission(this)"><a href="#mission">'+i+'</a></div>';	
				}else{
					missionBlocks+='<div class="mission" onclick="chooseMission(this)"><span>'+i+'</span></div>';
				}
			}
			$(".mission-blocks").html(missionBlocks);
			
			//选择关卡
			function chooseMission(obj){
				if(!$(obj).hasClass("active")){
					tip("关卡未解锁，请完成前面关卡来解锁")
				}
			}
			
			//随机打乱九个字
			var subject=data.subjects[0].words;
			var randWords=[].slice.call(subject).sort(function(){
				return Math.random()<0.5
			});
			$(".words-block").each(function(index,item){
				$(this).find("span").text(randWords[index]).attr("word-index",index);
			})
			
			//点击九宫格
			var chooseTag=0;//已经选择的字数
			var answerLen=data.subjects[0].answer.length; //答案长度
			$(".words").on("click",".words-block",function(){
				if(chooseTag<answerLen){
					var _thisText=$(this).text();
					$(this).html("");
					$(".answer-words").eq(chooseTag).text(_thisText);
					chooseTag++;
				}else{
					alert(1)
				}
			})
		</script>
	</body>
</html>
